(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/login/login"],{"0036":function(e,t,n){"use strict";(function(e){n("6cdc"),n("921b");r(n("66fd"));var t=r(n("a86a"));function r(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},3285:function(e,t,n){"use strict";n.r(t);var r=n("5714"),o=n.n(r);for(var a in r)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(a);t["default"]=o.a},5714:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n("4795")),o=a(n("3dd7"));function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t,n,r,o,a,s){try{var i=e[a](s),u=i.value}catch(c){return void n(c)}i.done?t(u):Promise.resolve(u).then(r,o)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){s(a,r,o,i,u,"next",e)}function u(e){s(a,r,o,i,u,"throw",e)}i(void 0)}))}}var u={name:"login",mixins:[],props:{},components:{},computed:{},data:function(){return{ptype:void 0,url:void 0,loading:!1,loginType:1,tips:"获取验证码",seconds:60,passwordImg:"",codeImg:"",forgetImg:"",roleVisible:!1,form:{phone:"",password:"",passwordImgValue:"",codeImgValue:"",forgetImgValue:"",code:"",forgetCode:"",newPassword:"",newPassword2:"",authPhoneCaptchaDetailId:void 0},list:[{name:"账号密码登录"},{name:"短信快捷登录"}],current:1,roles:[],checkRole:void 0,logoImage:n("3a38")}},onLoad:function(e){},created:function(){},onShow:function(){if(e.getStorageSync("token"))return e.switchTab({url:"/pages/index/index"})},beforeRouteEnter:function(e,t,n){console.log(t)},methods:{change:function(e){this.current=e},test:function(){},loginClick:function(){var e=this;return i(r.default.mark((function t(){var n;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.verify(),!n){t.next=4;break}return e.$toast(n),t.abrupt("return");case 4:e.go();case 5:case"end":return t.stop()}}),t)})))()},weChatLogin:function(){var t=wx,n=this;t.login({success:function(r){var a={"content-type":"application/x-www-form-urlencoded"};r.code&&t.request({url:"https://api.weixin.qq.com/sns/jscode2session",data:{appid:"wx6db2e40f820b9c1d",secret:"9155061a9b16cd4d4ff6564c15f36fad",grant_type:"authorization_code",js_code:r.code},method:"GET",header:a,success:function(r){var a=r.data.openid;n.$loading.open();var s={type:1,t:2,openid:a};o.default.threeLogin(s).then((function(t){1===t.code&&(n.$store.commit("updateToken",t.retObj),n.$store.dispatch("loadUser"),e.switchTab({url:"/pages/index/index"}),n.$loading.close())}),(function(e){n.$toast(e.msg),n.$loading.close()})),t.setStorageSync("openid",a)},fail:function(e){console.info("获取用户openid失败")}})}})},go:function(){var t=this;return i(r.default.mark((function n(){var a,s;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a={phone:t.form.phone,pwd:t.form.password},t.loading=!0,n.prev=2,n.next=5,o.default.auth(a);case 5:s=n.sent,n.next=11;break;case 8:n.prev=8,n.t0=n["catch"](2),console.log(n.t0);case 11:return 1===s.code&&(t.$store.commit("updateToken",s.retObj),t.$store.dispatch("loadUser"),e.switchTab({url:"/pages/index/index"})),t.loading=!1,t.$toast(s.msg),n.abrupt("return");case 15:case"end":return n.stop()}}),n,null,[[2,8]])})))()},getCode:function(){var e=arguments,t=this;return i(r.default.mark((function n(){var a,s,i;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=!(e.length>0&&void 0!==e[0])||e[0],t.$u.test.mobile(t.form.phone)){n.next=3;break}return n.abrupt("return",t.$toast("请输入正确的手机号"));case 3:if(!a){n.next=12;break}if(2!=t.loginType){n.next=9;break}if(!t.codeImg||t.form.codeImgValue){n.next=7;break}return n.abrupt("return",t.$toast("请输入图形验证码"));case 7:n.next=12;break;case 9:if(3!=t.loginType){n.next=12;break}if(!t.forgetImg||t.form.forgetImgValue){n.next=12;break}return n.abrupt("return",t.$toast("请输入图形验证码"));case 12:if(!t.$refs.uCode.canGetCode){n.next=28;break}return t.$loading.open(),s=t.dataFormat(),n.prev=15,n.next=18,o.default.getCode(s);case 18:i=n.sent,n.next=25;break;case 21:return n.prev=21,n.t0=n["catch"](15),n.t0.message&&t.$toast(n.t0.message),n.abrupt("return");case 25:if(!t.checkRes(i,a)){n.next=27;break}return n.abrupt("return");case 27:t.$refs.uCode.start();case 28:case"end":return n.stop()}}),n,null,[[15,21]])})))()},savePassword:function(){var e=this;return i(r.default.mark((function t(){var n,a,s;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.verify(),!n){t.next=4;break}return e.$toast(n),t.abrupt("return");case 4:return a={userName:e.form.phone,password:e.base64(e.form.newPassword),captcha:e.form.forgetCode},e.loading=!0,t.prev=6,t.next=9,o.default.updatePassword(a);case 9:s=t.sent,t.next=17;break;case 12:return t.prev=12,t.t0=t["catch"](6),e.loading=!1,t.t0.message&&e.$toast(t.t0.message),t.abrupt("return");case 17:if(!e.checkRes(s,!0)){t.next=20;break}return e.loading=!1,t.abrupt("return");case 20:e.$toast("密码修改成功，请使用新密码登录"),e.changeType(1),e.$store.commit("signout"),e.form.forgetCode="",e.form.newPassword="",e.form.newPassword2="",e.form.password="",e.loading=!1;case 28:case"end":return t.stop()}}),t,null,[[6,12]])})))()},voiceClick:function(){var t=this;if(!this.$u.test.mobile(this.form.phone))return this.$toast("请输入正确的手机号");if(2==this.loginType){if(this.codeImg&&!this.form.codeImgValue)return this.$toast("请输入图形验证码")}else if(3==this.loginType&&this.forgetImg&&!this.form.forgetImgValue)return this.$toast("请输入图形验证码");e.showModal({title:"确认发送语音验证码",success:function(){var e=i(r.default.mark((function e(){var n,a;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.dataFormat(),n.yzType=1,e.prev=2,e.next=5,o.default.getCode(n);case 5:a=e.sent,e.next=12;break;case 8:return e.prev=8,e.t0=e["catch"](2),e.t0.message&&t.$toast(e.t0.message),e.abrupt("return");case 12:if(!t.checkRes(a,!0)){e.next=14;break}return e.abrupt("return");case 14:t.$refs.uCode.start();case 15:case"end":return e.stop()}}),e,null,[[2,8]])})));function n(){return e.apply(this,arguments)}return n}()})},dataFormat:function(){},verify:function(){if(!this.$u.test.mobile(this.form.phone))return"请输入正确的手机号";if(1==this.loginType){if(!this.form.password)return"请输入密码"}else if(2==this.loginType){if(!this.form.code)return"请输入验证码"}else if(3==this.loginType){if(!this.form.forgetCode)return"请输入验证码";if(!this.form.newPassword)return"请输入密码";if(this.form.newPassword.length<6)return"密码至少6位";if(this.form.newPassword!=this.form.newPassword2)return"新密码两次输入不一致"}},changeType:function(t){this.loginType=t;var n="";switch(t){case 1:n="登录",this.authCaptcha();break;case 2:n="验证码登录";break;case 3:n="忘记密码";break;default:break}e.setNavigationBarTitle({title:n})},call:function(){e.makePhoneCall({phoneNumber:"400-006-2020"})},getUserProfile:function(){var e=wx,t=this;e.getUserProfile({desc:"获取你的昵称、头像、地区及性别",success:function(e){console.log(e),t.weChatLogin()},fail:function(e){t.$toast("微信授权失败")}})},base64:function(e){var t,n,r,o,a,s,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";r=e.length,n=0,t="";while(n<r){if(o=255&e.charCodeAt(n++),n===r){t+=i.charAt(o>>2),t+=i.charAt((3&o)<<4),t+="==";break}if(a=e.charCodeAt(n++),n===r){t+=i.charAt(o>>2),t+=i.charAt((3&o)<<4|(240&a)>>4),t+=i.charAt((15&a)<<2),t+="=";break}s=e.charCodeAt(n++),t+=i.charAt(o>>2),t+=i.charAt((3&o)<<4|(240&a)>>4),t+=i.charAt((15&a)<<2|(192&s)>>6),t+=i.charAt(63&s)}return t}}};t.default=u}).call(this,n("543d")["default"])},6464:function(e,t,n){"use strict";var r=n("b689"),o=n.n(r);o.a},a86a:function(e,t,n){"use strict";n.r(t);var r=n("c05c"),o=n("3285");for(var a in o)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(a);n("6464");var s,i=n("f0c5"),u=Object(i["a"])(o["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],s);t["default"]=u.exports},b689:function(e,t,n){},c05c:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return r}));var r={uTabs:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-tabs/u-tabs")]).then(n.bind(null,"5d62"))},uField:function(){return n.e("node-modules/uview-ui/components/u-field/u-field").then(n.bind(null,"c732"))},uButton:function(){return n.e("node-modules/uview-ui/components/u-button/u-button").then(n.bind(null,"d9ad"))},uIcon:function(){return n.e("node-modules/uview-ui/components/u-icon/u-icon").then(n.bind(null,"f86b"))}},o=function(){var e=this,t=e.$createElement;e._self._c},a=[]}},[["0036","common/runtime","common/vendor"]]]);